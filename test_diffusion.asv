addpath('./KPP');

Kv_iso = 1e-3;
dt = 0.1;
total_steps = 60 / dt;
Nz = 1000;
H  = 25; % m

m = Model(H, Nz, Kv_iso, dt);
m.showModelInfo();

slope_T = - 2 / H;
slope_S = 1 / H;
T_sfc = 30;
S_sfc = 35;

m.state.T = T_sfc + slope_T * m.grid.z_T;
m.state.S = S_sfc + slope_S * m.grid.z_T;

dT = 1; dT_width = 5; dT_cent = -H/2;
dS = 0.5; dS_width = 3; dS_cent = -H/4;

gau = @(mag, cent, width) mag * exp(-( (m.grid.z_T - cent) / width ).^2 );

m.state.T = m.state.T + gau(dT, dT_cent, dT_width);
m.state.S = m.state.S + gau(dS, dS_cent, dS_width);


m.update_b();

figure;

ax1 = subplot(1, 3, 1);
ax2 = subplot(1, 3, 2);
ax3 = subplot(1, 3, 3);

title(ax1, "T");
title(ax2, "S");
title(ax3, "b");

for step = 1:total_steps
    
    if mod(step, 1) == 0
        
        hold(ax1, 'on');
        plot(ax1, m.state.T, m.grid.z_T);
        hold(ax1, 'off');
        
        hold(ax2, 'on');
        plot(ax2, m.state.S, m.grid.z_T);
        hold(ax2, 'off');
        
        hold(ax3, 'on');
        plot(ax3, m.state.b, m.grid.z_T);
        hold(ax3, 'off');
        
        pause(1);
        
        int_S(end+1) = sum( m.grid.dz_T .* m.state.S);
        int_T(end+1) = sum( m.grid.dz_T .* m.state.S);
    end
    
    m.stepModel();
    
end



